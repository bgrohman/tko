/*! tko - v0.1.0 - 2012-12-24
* https://github.com/bgrohman/tko
* Copyright (c) 2012 Bryan Grohman; Licensed MIT */
(function(e,t){typeof define=="function"&&define.amd?define(["underscore","knockout","jquery","amplify","routie","bootstrap"],t):e.tko=t(e._,e.ko,e.$,e.amplify,e.routie)})(this,function(e,t,n,r,i){function s(){this.urlRoot=null,this.id=null,this.setProperties=function(n){var r=this,i,s,o;!e.isUndefined(n)&&!e.isNull(n)&&(i=t.toJS(n),e.each(e.keys(r),function(n){n!=="id"&&(s=r[n],t.isObservable(s)&&(o=i[n],e.isUndefined(o)||s(o)))}),e.isUndefined(i.id)||e.isNull(r.id)&&(r.id=t.observable(i.id)))},this.toJS=function(){var n=this,r={};return e.each(e.keys(n),function(e){t.isObservable(n[e])&&(r[e]=n[e]())}),r},this.save=function(){var r=this,i,s,o,u;return e.isUndefined(r.id)||e.isNull(r.id)?(o="POST",s=r.urlRoot):(o="PUT",i=t.isObservable(r.id)?r.id():r.id,s=r.urlRoot+"/"+i),u=n.ajax({type:o,url:s,cache:!1,data:r.toJS(),dataType:"json"}),u.done(function(n){e.isUndefined(n.id)||(r.id=t.observable(n.id))}),u},this.destroy=function(){var r=this,i;return e.isUndefined(r.id)?null:(i=t.isObservable(r.id)?r.id():r.id,n.ajax({type:"DELETE",url:r.urlRoot+"/"+i,cache:!1}))},this.fetch=function(){var r=this,i,s;return e.isUndefined(r.id)?null:(s=t.isObservable(r.id)?r.id():r.id,i=n.ajax({type:"GET",url:r.urlRoot+"/"+s,cache:!1}),i.done(function(e){r.setProperties(e)}),i)}}function o(n){var r=this;r.error=t.observable(),r.warning=t.observable(),r.success=t.observable(),r.info=t.observable(),r.clear=function(t){e.has(r,t)&&r[t](null)},r.visible=t.computed(function(){var t=["error","warning","success","info"];return e.any(t,function(t){var n=r[t]();return!(e.isUndefined(n)||e.isNull(n)||e.isEmpty(n))})})}function u(s){function c(){var t=window.location.hash,n,r=!0;e.isEmpty(t)||(n=t.substr(1),e.isEmpty(n)||(u.navigate(""),u.navigate(n),r=!1)),r&&e.isString(f)&&u.navigate(f)}function h(){e.isFunction(s)&&s.call(u),n(function(){t.applyBindings(u),c(),u.publish("app.initialized")})}var u=this,a=[],f,l={};u.notifications=new o(u),u.notify=function(t,n,r){e.has(u.notifications,t)&&(l[t]&&clearTimeout(l[t]),u.notifications[t](n),e.isNumber(r)&&(l[t]=setTimeout(function(){u.notifications.clear(t),l[t]=null},r)))},u.publish=function(e,t){r.publish(e,t)},u.subscribe=function(e,t){return r.subscribe(e,t)},u.unsubscribe=function(e,t){r.unsubscribe(e,t)},u.retrieveSetting=function(e){return r.store(e)},u.saveSetting=function(e,t){return r.store(e,t)},u.route=function(e,t){i(e,t)},u.navigate=function(e){i(e)},u.page=function(t,n,r){a.push(n),u.route(t,function(){e.each(a,function(e){e.visible(!1)}),n.visible(!0)}),r&&(f=t)},h()}return s.extend=function(n){return function(r){var i=new s;return e.each(n,function(e,n){t.isObservable(e)?i[n]=t.observable(e()):i[n]=e}),i.setProperties(r),i}},{Notifications:o,Model:s,App:u}});